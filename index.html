<!DOCTYPE html>
<html>
<head>
    <title>Color Picker</title>
    <meta charset="utf-8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f0f2f5;
            touch-action: manipulation; /* Добавлено для мобильных устройств */
        }
        .color-wheel {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: conic-gradient(
                #ff0000, #ff8000, #ffff00,
                #80ff00, #00ff00, #00ff80,
                #00ffff, #0080ff, #0000ff,
                #8000ff, #ff00ff, #ff0080,
                #ff0000
            );
            cursor: pointer;
            position: relative;
            overflow: hidden; /* Добавлено для корректного определения кликов */
        }
        .cursor {
            /* ... предыдущие стилы ... */
        }
    </style>
</head>
<body>
    <div class="color-wheel" id="colorWheel">
        <div class="cursor" id="cursor"></div>
    </div>

    <script>
        // Инициализация WebApp
        try {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            console.log('WebApp initialized');
        } catch (e) {
            console.error('WebApp init error:', e);
        }

        const wheel = document.getElementById('colorWheel');
        const cursor = document.getElementById('cursor');
        let isDragging = false;

        function getColor(e) {
            const rect = wheel.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const angle = Math.atan2(y - rect.height/2, x - rect.width/2) * 180 / Math.PI + 180;
            return `hsl(${angle}, 100%, 50%)`;
        }

        function handleInteractionStart(e) {
            isDragging = true;
            const event = e.type === 'touchstart' ? e.touches[0] : e;
            updateCursor(event);
            selectColor(event);
        }

        function handleInteractionMove(e) {
            if (!isDragging) return;
            const event = e.type === 'touchmove' ? e.touches[0] : e;
            updateCursor(event);
            selectColor(event);
        }

        function handleInteractionEnd() {
            isDragging = false;
            if (Telegram.WebApp.initDataUnsafe.user) {
                Telegram.WebApp.sendData(selectedColor);
                Telegram.WebApp.close();
            }
        }

        function updateCursor(e) {
            const rect = wheel.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            cursor.style.left = `${x - 10}px`;
            cursor.style.top = `${y - 10}px`;
        }

        function selectColor(e) {
            selectedColor = getColor(e);
            console.log('Selected color:', selectedColor);
        }

        // Обработчики событий
        wheel.addEventListener('mousedown', handleInteractionStart);
        wheel.addEventListener('mousemove', handleInteractionMove);
        wheel.addEventListener('mouseup', handleInteractionEnd);
        wheel.addEventListener('mouseleave', handleInteractionEnd);
        
        wheel.addEventListener('touchstart', handleInteractionStart);
        wheel.addEventListener('touchmove', handleInteractionMove);
        wheel.addEventListener('touchend', handleInteractionEnd);
    </script>
</body>
</html>
